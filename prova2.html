<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Impegni VIM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --light: #ecf0f1;
            --accent: #e74c3c;
            --success: #2ecc71;
            --dark: #34495e;
            --text: #2c3e50;
            --background: #f5f7fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            padding: 20px 0;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--secondary);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .app-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 22px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), #1a75bc);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--light), #d5dbdb);
            color: var(--text);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--accent), #c0392b);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #1a6399);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #d5dbdb, #c0c9c9);
        }
        
        .search-container {
            background: rgba(255, 255, 255, 0.92);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        .search-box {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .search-group {
            flex: 1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        select, input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            transition: border 0.3s;
        }
        
        select:focus, input:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .calendar-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            margin-bottom: 30px;
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
        }
        
        .calendar-nav {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .calendar-nav button {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .calendar-nav button:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }
        
        .current-month {
            font-size: 1.6rem;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            min-width: 220px;
            text-align: center;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            font-weight: 700;
            text-align: center;
            padding: 12px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .calendar-weekdays > div {
            padding: 5px;
            text-align: center;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e0e0e0;
        }
        
        .calendar-day {
            min-height: 140px;
            background-color: white;
            padding: 12px 10px;
            position: relative;
            transition: background 0.2s;
            display: flex;
            flex-direction: column;
        }
        
        .calendar-day:hover {
            background-color: #f9f9f9;
            transform: translateY(-2px);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .day-number {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            align-self: flex-end;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .event-item {
            font-size: 0.85rem;
            padding: 8px;
            margin: 4px 0;
            border-radius: 8px;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        
        .event-item:hover {
            transform: translateX(3px);
        }
        
        .event-journalist {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 4px solid #2196f3;
        }
        
        .event-technician {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-left: 4px solid #4caf50;
        }
        
        .today .day-number {
            background: linear-gradient(135deg, var(--secondary), #1a75bc);
            color: white;
        }
        
        .other-month {
            background-color: #f8f9fa;
            color: #adb5bd;
        }
        
        .other-month .day-number {
            color: #adb5bd;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px);
        }
        
        .modal-content {
            background-color: white;
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: modalAppear 0.4s ease-out;
        }
        
        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 1.6rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 22px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .btn-block {
            width: 100%;
            padding: 14px;
            font-size: 1.05rem;
            border-radius: 10px;
        }
        
        .event-details {
            margin-top: 20px;
        }
        
        .event-details p {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
        }
        
        .event-details strong {
            display: inline-block;
            width: 130px;
            color: var(--primary);
            font-size: 1.05rem;
        }
        
        .event-details span {
            flex: 1;
            font-size: 1.05rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 18px 28px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 2000;
            transform: translateX(120%);
            transition: transform 0.4s ease;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, var(--success), #27ae60);
            border-left: 5px solid #27ae60;
        }
        
        .notification.error {
            background: linear-gradient(135deg, var(--accent), #c0392b);
            border-left: 5px solid #c0392b;
        }
        
        .event-indicators {
            position: absolute;
            bottom: 8px;
            right: 8px;
            display: flex;
            gap: 5px;
        }
        
        .event-indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            box-shadow: 0 2px 3px rgba(0,0,0,0.2);
        }
        
        .event-indicator.journalist {
            background: linear-gradient(135deg, #2196f3, #0d47a1);
        }
        
        .event-indicator.technician {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
        }
        
        .event-title {
            font-weight: 600;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .manage-container {
            background: rgba(255, 255, 255, 0.92);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        .manage-section {
            margin-bottom: 25px;
        }
        
        .manage-section h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            color: var(--dark);
        }
        
        .manage-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .manage-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 12px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .manage-item button {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 1.2rem;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .manage-item button:hover {
            background-color: rgba(231, 76, 60, 0.1);
            transform: scale(1.1);
        }
        
        .manage-input {
            display: flex;
            gap: 10px;
        }
        
        .manage-input input {
            flex: 1;
        }
        
        /* Responsive Design */
        @media (max-width: 900px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .app-controls {
                width: 100%;
                justify-content: center;
            }
            
            .calendar-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .calendar-nav {
                order: 1;
            }
            
            .current-month {
                order: 2;
                font-size: 1.4rem;
            }
            
            .calendar-header .btn {
                order: 3;
            }
            
            .calendar-day {
                min-height: 120px;
            }
        }
        
        @media (max-width: 768px) {
            .calendar-weekdays {
                font-size: 0.85rem;
            }
            
            .calendar-day {
                min-height: 110px;
                padding: 10px 6px;
            }
            
            .day-number {
                font-size: 1rem;
            }
            
            .event-item {
                font-size: 0.75rem;
                padding: 6px;
            }
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 10px;
            }
            
            .calendar-weekdays {
                display: none;
            }
            
            .calendar-grid {
                display: block;
            }
            
            .calendar-days {
                grid-template-columns: repeat(1, 1fr);
                gap: 10px;
                background: transparent;
            }
            
            .calendar-day {
                min-height: auto;
                border-radius: 12px;
                padding: 15px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.08);
                border: 1px solid #eee;
            }
            
            .day-number {
                font-size: 1.3rem;
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 1px solid #eee;
                width: 100%;
                border-radius: 0;
                justify-content: flex-start;
            }
            
            .other-month {
                display: none;
            }
            
            .event-item {
                font-size: 0.9rem;
                white-space: normal;
                padding: 10px;
            }
            
            .event-indicators {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-box {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .modal-content {
                margin: 0 15px;
            }
            
            .manage-input {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-calendar-alt"></i>
                    <h1>Calendario Impegni VIM</h1>
                </div>
                <div class="app-controls">
                    <button class="btn btn-secondary" id="search-toggle">
                        <i class="fas fa-search"></i> Ricerca
                    </button>
                    <button class="btn btn-primary" id="add-event">
                        <i class="fas fa-plus"></i> Nuovo Impegno
                    </button>
                    <button class="btn btn-secondary" id="manage-people">
                        <i class="fas fa-users-cog"></i> Gestisci Persone
                    </button>
                </div>
            </div>
        </header>
        
        <div class="search-container" id="search-container">
            <div class="search-box">
                <div class="search-group">
                    <label for="search-journalist">Cerca per Giornalista</label>
                    <select id="search-journalist">
                        <option value="">Tutti i giornalisti</option>
                    </select>
                </div>
                <div class="search-group">
                    <label for="search-technician">Cerca per Tecnico</label>
                    <select id="search-technician">
                        <option value="">Tutti i tecnici</option>
                    </select>
                </div>
                <div class="search-group">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary btn-block" id="apply-search">
                        <i class="fas fa-filter"></i> Applica Filtri
                    </button>
                </div>
            </div>
        </div>
        
        <div class="calendar-container">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                    <div class="current-month" id="current-month">Maggio 2025</div>
                    <button id="next-month"><i class="fas fa-chevron-right"></i></button>
                </div>
                <button class="btn btn-secondary" id="today-btn">Oggi</button>
            </div>
            
            <div class="calendar-grid">
                <div class="calendar-weekdays">
                    <div>Lunedì</div>
                    <div>Martedì</div>
                    <div>Mercoledì</div>
                    <div>Giovedì</div>
                    <div>Venerdì</div>
                    <div>Sabato</div>
                    <div>Domenica</div>
                </div>
                <div class="calendar-days" id="calendar-days">
                    <!-- Calendar days will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Event Modal -->
    <div class="modal" id="event-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Nuovo Impegno</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="event-form">
                    <input type="hidden" id="event-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="event-date">Data</label>
                            <input type="date" id="event-date" required>
                        </div>
                        <div class="form-group">
                            <label for="event-time">Ora</label>
                            <input type="time" id="event-time" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="event-journalist">Giornalista</label>
                        <select id="event-journalist" required>
                            <option value="">Seleziona giornalista</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="event-technician">Tecnico</label>
                        <select id="event-technician" required>
                            <option value="">Seleziona tecnico</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="event-title">Evento</label>
                        <input type="text" id="event-title" required placeholder="Titolo dell'evento">
                    </div>
                    
                    <div class="form-group">
                        <label for="event-location">Luogo</label>
                        <input type="text" id="event-location" required placeholder="Dove si svolge">
                    </div>
                    
                    <div class="form-group">
                        <label for="event-notes">Note</label>
                        <textarea id="event-notes" rows="3" placeholder="Note aggiuntive..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> Salva Impegno
                        </button>
                    </div>
                </form>
                
                <div class="event-details" id="event-details" style="display:none;">
                    <h3>Dettagli Impegno</h3>
                    <p><strong>Data:</strong> <span id="detail-date"></span></p>
                    <p><strong>Ora:</strong> <span id="detail-time"></span></p>
                    <p><strong>Giornalista:</strong> <span id="detail-journalist"></span></p>
                    <p><strong>Tecnico:</strong> <span id="detail-technician"></span></p>
                    <p><strong>Evento:</strong> <span id="detail-title"></span></p>
                    <p><strong>Luogo:</strong> <span id="detail-location"></span></p>
                    <p><strong>Note:</strong> <span id="detail-notes"></span></p>
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" id="edit-event" style="flex: 1;">
                            <i class="fas fa-edit"></i> Modifica
                        </button>
                        <button class="btn btn-danger" id="delete-event" style="flex: 1;">
                            <i class="fas fa-trash"></i> Elimina
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Manage People Modal -->
    <div class="modal" id="manage-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gestisci Giornalisti e Tecnici</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="manage-container">
                    <div class="manage-section">
                        <h3>Giornalisti</h3>
                        <div class="manage-list" id="journalist-list">
                            <!-- Journalists will be added here -->
                        </div>
                        <div class="manage-input">
                            <input type="text" id="new-journalist" placeholder="Aggiungi nuovo giornalista">
                            <button class="btn btn-primary" id="add-journalist">
                                <i class="fas fa-plus"></i> Aggiungi
                            </button>
                        </div>
                    </div>
                    
                    <div class="manage-section">
                        <h3>Tecnici</h3>
                        <div class="manage-list" id="technician-list">
                            <!-- Technicians will be added here -->
                        </div>
                        <div class="manage-input">
                            <input type="text" id="new-technician" placeholder="Aggiungi nuovo tecnico">
                            <button class="btn btn-primary" id="add-technician">
                                <i class="fas fa-plus"></i> Aggiungi
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <script>
        // App State
        const state = {
            currentDate: new Date(2025, 4, 29), // May 29, 2025
            events: [],
            journalists: [],
            technicians: [],
            editingEvent: null,
            filteredEvents: null
        };
        
        // DOM Elements
        const elements = {
            calendarDays: document.getElementById('calendar-days'),
            currentMonth: document.getElementById('current-month'),
            prevMonthBtn: document.getElementById('prev-month'),
            nextMonthBtn: document.getElementById('next-month'),
            todayBtn: document.getElementById('today-btn'),
            eventModal: document.getElementById('event-modal'),
            eventForm: document.getElementById('event-form'),
            modalTitle: document.getElementById('modal-title'),
            eventId: document.getElementById('event-id'),
            eventDate: document.getElementById('event-date'),
            eventTime: document.getElementById('event-time'),
            eventJournalist: document.getElementById('event-journalist'),
            eventTechnician: document.getElementById('event-technician'),
            eventTitle: document.getElementById('event-title'),
            eventLocation: document.getElementById('event-location'),
            eventNotes: document.getElementById('event-notes'),
            eventDetails: document.getElementById('event-details'),
            detailDate: document.getElementById('detail-date'),
            detailTime: document.getElementById('detail-time'),
            detailJournalist: document.getElementById('detail-journalist'),
            detailTechnician: document.getElementById('detail-technician'),
            detailTitle: document.getElementById('detail-title'),
            detailLocation: document.getElementById('detail-location'),
            detailNotes: document.getElementById('detail-notes'),
            editEventBtn: document.getElementById('edit-event'),
            deleteEventBtn: document.getElementById('delete-event'),
            closeModalBtn: document.querySelectorAll('.close-modal'),
            addEventBtn: document.getElementById('add-event'),
            searchToggle: document.getElementById('search-toggle'),
            searchContainer: document.getElementById('search-container'),
            searchJournalist: document.getElementById('search-journalist'),
            searchTechnician: document.getElementById('search-technician'),
            applySearchBtn: document.getElementById('apply-search'),
            notification: document.getElementById('notification'),
            manageModal: document.getElementById('manage-modal'),
            managePeopleBtn: document.getElementById('manage-people'),
            journalistList: document.getElementById('journalist-list'),
            technicianList: document.getElementById('technician-list'),
            newJournalist: document.getElementById('new-journalist'),
            addJournalistBtn: document.getElementById('add-journalist'),
            newTechnician: document.getElementById('new-technician'),
            addTechnicianBtn: document.getElementById('add-technician')
        };
        
        // Initialize the application
        function initApp() {
            loadPeople();
            loadEvents();
            renderCalendar();
            setupEventListeners();
            updatePeopleDropdowns();
        }
        
        // Load people from localStorage
        function loadPeople() {
            const savedJournalists = localStorage.getItem('journalists');
            const savedTechnicians = localStorage.getItem('technicians');
            
            state.journalists = savedJournalists ? JSON.parse(savedJournalists) : [
                "Tizio Tizi", "Caio Caii", "Mario Rossi", "Giulia Verdi"
            ];
            
            state.technicians = savedTechnicians ? JSON.parse(savedTechnicians) : [
                "Franco Franchi", "Marco Marchi", "Luigi Bianchi", "Anna Neri"
            ];
        }
        
        // Save people to localStorage
        function savePeople() {
            localStorage.setItem('journalists', JSON.stringify(state.journalists));
            localStorage.setItem('technicians', JSON.stringify(state.technicians));
        }
        
        // Load events from localStorage
        function loadEvents() {
            const savedEvents = localStorage.getItem('calendarEvents');
            if (savedEvents) {
                state.events = JSON.parse(savedEvents);
                // Convert date strings to Date objects
                state.events.forEach(event => {
                    event.date = new Date(event.date);
                });
            } else {
                // Sample events for demo
                state.events = [
                    {
                        id: 1,
                        date: new Date(2025, 4, 29, 10, 0),
                        journalist: "Tizio Tizi",
                        technician: "Franco Franchi",
                        title: "Intervista al Sindaco",
                        location: "Sala Conferenze",
                        notes: "Portare attrezzatura video completa"
                    },
                    {
                        id: 2,
                        date: new Date(2025, 4, 29, 14, 30),
                        journalist: "Caio Caii",
                        technician: "Marco Marchi",
                        title: "Partita di Calcio",
                        location: "Stadio Comunale",
                        notes: "Copertura per la finale"
                    },
                    {
                        id: 3,
                        date: new Date(2025, 4, 30, 9, 0),
                        journalist: "Mario Rossi",
                        technician: "Anna Neri",
                        title: "Conferenza Stampa",
                        location: "Palazzo della Provincia",
                        notes: "Evento con autorità regionali"
                    }
                ];
                saveEvents();
            }
        }
        
        // Save events to localStorage
        function saveEvents() {
            // Convert Date objects to ISO strings for storage
            const eventsForStorage = state.events.map(event => ({
                ...event,
                date: event.date.toISOString()
            }));
            localStorage.setItem('calendarEvents', JSON.stringify(eventsForStorage));
        }
        
        // Render the calendar
        function renderCalendar() {
            // Clear existing calendar
            elements.calendarDays.innerHTML = '';
            
            // Set current month header
            const monthNames = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 
                               'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
            const month = state.currentDate.getMonth();
            const year = state.currentDate.getFullYear();
            elements.currentMonth.textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // Calculate starting day (0 = Sunday, 1 = Monday, etc.)
            let startDay = firstDay.getDay();
            // Adjust for Monday as first day of week
            startDay = startDay === 0 ? 6 : startDay - 1;
            
            // Create day cells
            const today = new Date();
            today.setHours(0,0,0,0);
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startDay; i++) {
                const dayElement = createDayElement(null, month, year, true);
                elements.calendarDays.appendChild(dayElement);
            }
            
            // Add cells for each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === today.toDateString();
                const dayElement = createDayElement(day, month, year, false, isToday);
                elements.calendarDays.appendChild(dayElement);
            }
        }
        
        // Create a day element
        function createDayElement(day, month, year, isOtherMonth, isToday = false) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            if (isOtherMonth) dayElement.classList.add('other-month');
            if (isToday) dayElement.classList.add('today');
            
            if (day !== null) {
                dayElement.innerHTML = `<div class="day-number">${day}</div>`;
                
                // Add events for this day
                const date = new Date(year, month, day);
                const eventsForDay = getEventsForDate(date);
                
                // Add event indicators
                const hasJournalistEvents = eventsForDay.some(e => e.journalist);
                const hasTechnicianEvents = eventsForDay.some(e => e.technician);
                
                if (hasJournalistEvents || hasTechnicianEvents) {
                    const indicators = document.createElement('div');
                    indicators.className = 'event-indicators';
                    
                    if (hasJournalistEvents) {
                        const indicator = document.createElement('div');
                        indicator.className = 'event-indicator journalist';
                        indicators.appendChild(indicator);
                    }
                    
                    if (hasTechnicianEvents) {
                        const indicator = document.createElement('div');
                        indicator.className = 'event-indicator technician';
                        indicators.appendChild(indicator);
                    }
                    
                    dayElement.appendChild(indicators);
                }
                
                // Add event items
                eventsForDay.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = `event-item ${event.journalist ? 'event-journalist' : 'event-technician'}`;
                    eventElement.innerHTML = `
                        <span class="event-time">${formatTime(event.date)}</span>
                        <span class="event-title">${event.title}</span>
                    `;
                    eventElement.addEventListener('click', () => showEventDetails(event));
                    dayElement.appendChild(eventElement);
                });
                
                // Add click event to create new appointment
                dayElement.addEventListener('click', (e) => {
                    if (e.target === dayElement || e.target.classList.contains('day-number')) {
                        openEventForm(date);
                    }
                });
            }
            
            return dayElement;
        }
        
        // Get events for a specific date
        function getEventsForDate(date) {
            // Normalize dates to compare without time
            const normalizedDate = new Date(date);
            normalizedDate.setHours(0,0,0,0);
            
            let events = state.filteredEvents || state.events;
            
            return events.filter(event => {
                const eventDate = new Date(event.date);
                eventDate.setHours(0,0,0,0);
                return eventDate.getTime() === normalizedDate.getTime();
            });
        }
        
        // Format time for display
        function formatTime(date) {
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
        // Format date for display
        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        // Open event form
        function openEventForm(date = null, event = null) {
            if (event) {
                // Editing existing event
                state.editingEvent = event;
                elements.modalTitle.textContent = "Modifica Impegno";
                elements.eventId.value = event.id;
                elements.eventDate.value = formatDateForInput(event.date);
                elements.eventTime.value = formatTimeForInput(event.date);
                elements.eventJournalist.value = event.journalist;
                elements.eventTechnician.value = event.technician;
                elements.eventTitle.value = event.title;
                elements.eventLocation.value = event.location;
                elements.eventNotes.value = event.notes || '';
                elements.eventForm.style.display = 'block';
                elements.eventDetails.style.display = 'none';
            } else {
                // Creating new event
                state.editingEvent = null;
                elements.modalTitle.textContent = "Nuovo Impegno";
                elements.eventForm.reset();
                elements.eventId.value = '';
                
                if (date) {
                    elements.eventDate.value = formatDateForInput(date);
                    // Set default time to next full hour
                    const now = new Date();
                    elements.eventTime.value = `${now.getHours().toString().padStart(2, '0')}:00`;
                } else {
                    // Default to today
                    const today = new Date();
                    elements.eventDate.value = formatDateForInput(today);
                    elements.eventTime.value = formatTimeForInput(today);
                }
                
                elements.eventForm.style.display = 'block';
                elements.eventDetails.style.display = 'none';
            }
            
            elements.eventModal.style.display = 'flex';
        }
        
        // Format date for input[type="date"]
        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Format time for input[type="time"]
        function formatTimeForInput(date) {
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }
        
        // Show event details
        function showEventDetails(event) {
            state.editingEvent = event;
            elements.modalTitle.textContent = "Dettagli Impegno";
            elements.eventId.value = event.id;
            
            // Format date and time
            const dateStr = formatDate(event.date);
            const timeStr = formatTime(event.date);
            
            elements.detailDate.textContent = dateStr;
            elements.detailTime.textContent = timeStr;
            elements.detailJournalist.textContent = event.journalist;
            elements.detailTechnician.textContent = event.technician;
            elements.detailTitle.textContent = event.title;
            elements.detailLocation.textContent = event.location;
            elements.detailNotes.textContent = event.notes || 'Nessuna nota';
            
            elements.eventForm.style.display = 'none';
            elements.eventDetails.style.display = 'block';
            elements.eventModal.style.display = 'flex';
        }
        
        // Save event from form
        function saveEvent(eventData) {
            // Create or update event
            if (eventData.id) {
                // Update existing event
                const index = state.events.findIndex(e => e.id === eventData.id);
                if (index !== -1) {
                    state.events[index] = eventData;
                }
            } else {
                // Create new event
                eventData.id = Date.now(); // Simple unique ID
                state.events.push(eventData);
            }
            
            // Save to localStorage
            saveEvents();
            
            // Re-render calendar
            renderCalendar();
            
            // Close modal
            closeModal();
            
            // Show success notification
            showNotification('Impegno salvato con successo!', 'success');
        }
        
        // Delete current event
        function deleteEvent() {
            if (!state.editingEvent) return;
            
            const eventId = state.editingEvent.id;
            state.events = state.events.filter(event => event.id !== eventId);
            
            // Save to localStorage
            saveEvents();
            
            // Re-render calendar
            renderCalendar();
            
            // Close modal
            closeModal();
            
            // Show notification
            showNotification('Impegno eliminato', 'success');
        }
        
        // Close modal
        function closeModal() {
            elements.eventModal.style.display = 'none';
            elements.manageModal.style.display = 'none';
            state.editingEvent = null;
        }
        
        // Show notification
        function showNotification(message, type) {
            elements.notification.textContent = message;
            elements.notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }
        
        // Apply search filters
        function applySearchFilters() {
            const journalist = elements.searchJournalist.value;
            const technician = elements.searchTechnician.value;
            
            if (!journalist && !technician) {
                state.filteredEvents = null;
            } else {
                state.filteredEvents = state.events.filter(event => {
                    const matchesJournalist = journalist ? event.journalist === journalist : true;
                    const matchesTechnician = technician ? event.technician === technician : true;
                    return matchesJournalist && matchesTechnician;
                });
            }
            
            renderCalendar();
            showNotification('Filtri applicati', 'success');
        }
        
        // Update people dropdowns
        function updatePeopleDropdowns() {
            // Update journalist dropdowns
            elements.eventJournalist.innerHTML = '<option value="">Seleziona giornalista</option>';
            elements.searchJournalist.innerHTML = '<option value="">Tutti i giornalisti</option>';
            
            state.journalists.forEach(journalist => {
                const option1 = document.createElement('option');
                option1.value = journalist;
                option1.textContent = journalist;
                elements.eventJournalist.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = journalist;
                option2.textContent = journalist;
                elements.searchJournalist.appendChild(option2);
            });
            
            // Update technician dropdowns
            elements.eventTechnician.innerHTML = '<option value="">Seleziona tecnico</option>';
            elements.searchTechnician.innerHTML = '<option value="">Tutti i tecnici</option>';
            
            state.technicians.forEach(technician => {
                const option1 = document.createElement('option');
                option1.value = technician;
                option1.textContent = technician;
                elements.eventTechnician.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = technician;
                option2.textContent = technician;
                elements.searchTechnician.appendChild(option2);
            });
        }
        
        // Render people lists
        function renderPeopleLists() {
            // Render journalists
            elements.journalistList.innerHTML = '';
            state.journalists.forEach(journalist => {
                const item = document.createElement('div');
                item.className = 'manage-item';
                item.innerHTML = `
                    <span>${journalist}</span>
                    <button data-name="${journalist}" data-type="journalist">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                elements.journalistList.appendChild(item);
            });
            
            // Render technicians
            elements.technicianList.innerHTML = '';
            state.technicians.forEach(technician => {
                const item = document.createElement('div');
                item.className = 'manage-item';
                item.innerHTML = `
                    <span>${technician}</span>
                    <button data-name="${technician}" data-type="technician">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                elements.technicianList.appendChild(item);
            });
        }
        
        // Add journalist
        function addJournalist() {
            const name = elements.newJournalist.value.trim();
            if (name && !state.journalists.includes(name)) {
                state.journalists.push(name);
                savePeople();
                updatePeopleDropdowns();
                renderPeopleLists();
                elements.newJournalist.value = '';
                showNotification('Giornalista aggiunto', 'success');
            } else if (state.journalists.includes(name)) {
                showNotification('Giornalista già presente', 'error');
            }
        }
        
        // Add technician
        function addTechnician() {
            const name = elements.newTechnician.value.trim();
            if (name && !state.technicians.includes(name)) {
                state.technicians.push(name);
                savePeople();
                updatePeopleDropdowns();
                renderPeopleLists();
                elements.newTechnician.value = '';
                showNotification('Tecnico aggiunto', 'success');
            } else if (state.technicians.includes(name)) {
                showNotification('Tecnico già presente', 'error');
            }
        }
        
        // Remove person
        function removePerson(name, type) {
            if (type === 'journalist') {
                state.journalists = state.journalists.filter(j => j !== name);
            } else {
                state.technicians = state.technicians.filter(t => t !== name);
            }
            
            savePeople();
            updatePeopleDropdowns();
            renderPeopleLists();
            showNotification(`${type === 'journalist' ? 'Giornalista' : 'Tecnico'} rimosso`, 'success');
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            elements.prevMonthBtn.addEventListener('click', () => {
                state.currentDate.setMonth(state.currentDate.getMonth() - 1);
                renderCalendar();
            });
            
            elements.nextMonthBtn.addEventListener('click', () => {
                state.currentDate.setMonth(state.currentDate.getMonth() + 1);
                renderCalendar();
            });
            
            elements.todayBtn.addEventListener('click', () => {
                state.currentDate = new Date();
                renderCalendar();
            });
            
            // Event form
            elements.eventForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const date = new Date(elements.eventDate.value);
                const time = elements.eventTime.value.split(':');
                date.setHours(parseInt(time[0]), parseInt(time[1]));
                
                const eventData = {
                    id: elements.eventId.value ? parseInt(elements.eventId.value) : null,
                    date: date,
                    journalist: elements.eventJournalist.value,
                    technician: elements.eventTechnician.value,
                    title: elements.eventTitle.value,
                    location: elements.eventLocation.value,
                    notes: elements.eventNotes.value
                };
                
                saveEvent(eventData);
            });
            
            // Event details actions
            elements.editEventBtn.addEventListener('click', () => {
                if (state.editingEvent) {
                    openEventForm(null, state.editingEvent);
                }
            });
            
            elements.deleteEventBtn.addEventListener('click', () => {
                if (confirm('Sei sicuro di voler eliminare questo impegno?')) {
                    deleteEvent();
                }
            });
            
            // Modal close
            elements.closeModalBtn.forEach(btn => {
                btn.addEventListener('click', closeModal);
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === elements.eventModal || e.target === elements.manageModal) {
                    closeModal();
                }
            });
            
            // Add new event button
            elements.addEventBtn.addEventListener('click', () => {
                openEventForm();
            });
            
            // Search toggle
            elements.searchToggle.addEventListener('click', () => {
                elements.searchContainer.style.display = 
                    elements.searchContainer.style.display === 'none' ? 'block' : 'block';
            });
            
            // Apply search filters
            elements.applySearchBtn.addEventListener('click', applySearchFilters);
            
            // Close search when clicking outside
            document.addEventListener('click', (e) => {
                if (!elements.searchContainer.contains(e.target) && 
                    !elements.searchToggle.contains(e.target) &&
                    elements.searchContainer.style.display !== 'none') {
                    elements.searchContainer.style.display = 'none';
                }
            });
            
            // Manage people
            elements.managePeopleBtn.addEventListener('click', () => {
                renderPeopleLists();
                elements.manageModal.style.display = 'flex';
            });
            
            // Add journalist
            elements.addJournalistBtn.addEventListener('click', addJournalist);
            elements.newJournalist.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addJournalist();
                }
            });
            
            // Add technician
            elements.addTechnicianBtn.addEventListener('click', addTechnician);
            elements.newTechnician.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTechnician();
                }
            });
            
            // Remove person (delegated event)
            document.addEventListener('click', (e) => {
                if (e.target.closest('button[data-name]')) {
                    const button = e.target.closest('button');
                    const name = button.getAttribute('data-name');
                    const type = button.getAttribute('data-type');
                    removePerson(name, type);
                }
            });
        }
        
        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>